<!doctype html>
<html lang="{{ page.lang or lang or 'en' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ title or "TurboChef" }}</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-gray-50 text-gray-900 relative overflow-x-hidden">
  <div class="bg-blob"></div>
  <div class="animated-bg"></div>
  <header class="max-w-3xl mx-auto p-6">
    <div class="flex items-center gap-4">
      <img src="/assets/chef-hat.svg" alt="Chef Hat" class="w-12 h-12 drop-shadow-lg">
      <h1 class="text-5xl font-serif font-bold tracking-tight text-accent drop-shadow">TurboChef</h1>
    </div>
    <nav class="mt-6 flex gap-4 nav-bar">
      {% set pageLang = page.lang or lang or 'en' %}
      {% if page.lang == 'fr' or (page.url and '/fr/' in page.url) or (page.inputPath and '.fr.' in page.inputPath) %}
        {% set pageLang = 'fr' %}
      {% endif %}
      {% if pageLang == 'fr' %}
        {% set langPrefix = '/fr' %}
      {% else %}
        {% set langPrefix = '' %}
      {% endif %}
      <a class="nav-link" href="{{ langPrefix }}/">{% if pageLang == 'fr' %}Accueil{% else %}Home{% endif %}</a>
      <a class="nav-link" href="{{ langPrefix }}/recipes/cooking/">{% if pageLang == 'fr' %}Cuisine{% else %}Cooking{% endif %}</a>
      <a class="nav-link" href="{{ langPrefix }}/recipes/baking/">{% if pageLang == 'fr' %}Boulangerie{% else %}Baking{% endif %}</a>
      <a class="nav-link" href="{{ langPrefix }}/recipes/sauces/">{% if pageLang == 'fr' %}Sauces{% else %}Sauces{% endif %}</a>
    </nav>
    <div class="lang-switcher">
      <label for="lang-select" class="sr-only">Language</label>
      <select id="lang-select" class="lang-select">
        <option value="en">English</option>
        <option value="fr">Français</option>
      </select>
    </div>
    <script>
      // Language switcher logic
      (function() {
        const select = document.getElementById('lang-select');
        const path = window.location.pathname;
        // Detect current language: pages may be under /fr/ OR use a filename suffix like ".fr"
        const isFrench = path.startsWith('/fr/') || path.indexOf('.fr') !== -1;
        select.value = isFrench ? 'fr' : 'en';
        select.addEventListener('change', function() {
          let newPath = path;
          if (this.value === 'fr') {
            // Switch to French canonical path: ensure /fr prefix and remove any .fr filename markers
            if (!path.startsWith('/fr/')) {
              // Remove any trailing `.fr` segments (e.g. /recipes/.../slug.fr/ or /slug.fr)
              const cleaned = path.replace(/\.fr(\/|$)/, '/');
              newPath = '/fr' + (cleaned === '/' ? '' : cleaned);
            }
          } else {
            // Switch to English canonical path: remove /fr prefix and any .fr markers
            if (path.startsWith('/fr/')) {
              newPath = path.replace(/^\/fr/, '') || '/';
            } else {
              newPath = path.replace(/\.fr(\/|$)/, '/');
            }
          }
          // Normalize double-slashes
          newPath = newPath.replace(/\/\/+/, '/');
          window.location.pathname = newPath;
        });
      })();
    </script>
  </header>
  <main class="max-w-3xl mx-auto p-6">
    {{ content | safe }}
  </main>
  <script src="/assets/search.js"></script>
  <footer class="max-w-3xl mx-auto p-6 text-sm text-gray-600 border-t mt-12">
    <span class="font-bold text-accent">© {{ site.year }} TurboChef</span>
    <span class="ml-2">A modern personal cookbook.</span>
  </footer>
</body>
</html>
